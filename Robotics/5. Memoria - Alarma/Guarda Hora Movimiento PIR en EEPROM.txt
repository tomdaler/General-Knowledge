Sketch \ Include Libraery \ EEPROM

#include <EEPROM.h>

#include <TimeAlarms.h>
#include <Time.h>

int pos1;
int SenPIR = 2;

void setup()
{
   pinMode(SenPIR,INPUT);
   Serial.begin(9600);

   CleanMem();

   byte bHora = EEPROM.read(0);
   int minuto = 0;
 
   setTime(bHora, minuto, 0, 1, 11, 11);
   Alarm.delay(1000);
}

void loop()
{
   String str1 = Serial.StringRead();

   if (str1=="c") CleanMem();
   if (str1=="r") ReadMem();

   if (str1 >= "0" || str1 <= "24") SetHour(str1);

   CheckPIR();
}

void SetHour(char str1)
{
   byte hora = (byte)str1;
   EEPROM.update(0, hora);
}

void ReadMem()
{
   for (int i =1; i< EEPROM.length(), i++)
   {
      byte bData = EEPROM.read(i);
      if (bData != 0) continue;
      Serial.println(String(bData);             
   }   
}

void CleanMem()
{
   for (int i =1; i< EEPROM.length(), i++)
        EEPROM.update(i,0);
   pos1 = 1;
}


void CheckPIR()
{
   int sensorPIR = digitalRead(SenPIR);
   if (sensorPIR ==0) return;

   int hh = hour();
   int mm = minute();
   int mm2 = 0;

   mm = mm  /10;   

   byte momento = hh*10 + mm;  
   // 0..1024  
   //8:30   83   14:45 144
   
   EEPROM.update(pos1, momento);
   pos1++;
   if (pos1 == EEPROM.length()) pos1 = 1;

   // Espere 5 minutos para monitorear movimiento
   delay(5 * 60 * 1000);
}
